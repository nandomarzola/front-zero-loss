<div class="products-container">
  <header class="page-header">
    <div class="title-group">
      <h1>Meus Produtos</h1>
      <p>Gerencie pre√ßos e custos da sua base local.</p>
    </div>
    <div class="action-group">
      <input type="file" #fileInput (change)="onFileSelected($event)" hidden accept=".xlsx">
      <button class="btn-import" (click)="fileInput.click()">üìÅ Importar Planilha</button>
    </div>
  </header>

  <div class="card">
    <div class="table-wrapper">
      <table class="custom-table" *ngIf="products().length > 0 && !isLoading()">
        <thead>
          <tr>
            <th>PRODUTO / VARIA√á√ÉO</th>
            <th class="text-center">ESTOQUE</th>
            <th class="text-center">VENDA UNIT.</th>
            <th class="text-center">CMV UNIT. (Custo)</th>
            <th class="text-center">LUCRO L√çQUIDO</th> <th class="text-center">MARGEM</th>
            <th class="text-center">A√á√ïES</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of products()">
            <td>
              <div class="prod-title">{{ item.product_name }}</div>
              <div class="prod-sub">{{ item.variation_name || '√önico' }}</div>
            </td>
            <td class="text-center">
              <input 
                type="number" 
                [(ngModel)]="item.stock" 
                (input)="recalcularItem(item)"
                (blur)="salvarAlteracoes(item)" 
                class="table-input"
                style="width: 70px; font-weight: bold; text-align: center;">
            </td>
            
            <td class="text-center">
              <input 
                type="number" 
                [(ngModel)]="item.sale_price" 
                (input)="recalcularItem(item)" 
                (blur)="salvarAlteracoes(item)" 
                class="table-input blue">
            </td>

            <td class="text-center">
              <input 
                type="number" 
                [(ngModel)]="item.cost_price" 
                (input)="recalcularItem(item)" 
                (blur)="salvarAlteracoes(item)" 
                class="table-input orange">
            </td>

            <td class="text-center green bold">
              {{ (item.sale_price * (item.margin_percentage / 100)) | currency:'BRL' }}
            </td>

            <td class="text-center">
              <span class="margin-badge" [style.background]="getMargemColor(item.margin_percentage)">
                {{ item.margin_percentage | number:'1.1-1' }}%
              </span>
            </td>

            <td class="text-center">
              <button [routerLink]="['/analyzer', item.id]" class="btn-icon">üí∞ Detalhar</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="isLoading()" class="loading-state">
      <div class="spinner"></div>
      <p>Carregando sua base de produtos...</p>
    </div>

    <div *ngIf="products().length === 0 && !isLoading()" class="empty-state">
      <div class="empty-content">
        <div class="icon-box">üì¶</div>
        <h3>Sua lista est√° vazia</h3>
        <p>Importe a planilha de "Performance do Produto" da Shopee para come√ßar a gerenciar seus custos.</p>
        <button class="btn-import mt-3" (click)="fileInput.click()">
          üìÅ Selecionar Arquivo CSV
        </button>
      </div>
    </div>
  </div>
</div>